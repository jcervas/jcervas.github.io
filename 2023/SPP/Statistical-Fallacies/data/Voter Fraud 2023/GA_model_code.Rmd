---
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
header-includes: 
   - \usepackage{wrapfig}
   - \usepackage{caption}
---

```{r}
library(tidyverse)
library(dplyr)
load("GA/GA_model_data.Rdata")
```

```{r}
# Unpaired models
lm_GA_m <- lm(Porp_Trump_Absentee ~ Porp_Trump_election_day + county_party, # Reduce model
             data = Conglomerate_Absentee_Border)
lm_GA <- lm(Porp_Trump_Absentee ~ Porp_Trump_election_day + county_party + Minority + Age + income + Internet + vehicle + School, # Full model
             data = Conglomerate_Absentee_Border)

lm_GA %>% summary
# lmtest::coeftest(lm_GA, vcov = sandwich::vcovHC(lm_GA, "HC3"))

lm_GA %>% plot(1, main = "Full")
lm_GA_m %>% plot(1)
lm_GA %>% plot(2, main = "Full")
lm_GA_m %>% plot(2)

(GA_anova <- anova(lm_GA_m, lm_GA, test = "F")) # F test
```

```{r}
# Precinct matching models
lm_GA_D_m <- lm(Porp_Trump_Absentee ~ Porp_Trump_election_day + ring, data = Precinct_match_data_3rd) # Reduce model
lm_GA_D <- lm(Porp_Trump_Absentee ~ Porp_Trump_election_day + ring + Minority + Age + income + Internet + vehicle + School, # Full model
              data = Precinct_match_data_3rd)

lm_GA_D %>% summary
# lmtest::coeftest(lm_GA_D, vcov = sandwich::vcovHC(lm_GA_D, "HC3"))

lm_GA_D %>% plot(1, main = "Full")
lm_GA_D_m %>% plot(1)
lm_GA_D %>% plot(2, main = "Full")
lm_GA_D_m %>% plot(2)

(GA_anova_D <- anova(lm_GA_D_m, lm_GA_D, test = "F")) # F test
```

```{r}
# Test that negative of difference calculation does not affect conclusions

# Precinct_match_data_3rd_neg1 <- Precinct_match_data_3rd %>% 
#   dplyr::mutate(Porp_Trump_Absentee = Porp_Trump_Absentee * (-1),
#                 Porp_Trump_election_day = Porp_Trump_election_day * (-1),
#                 Minority = Minority * (-1),
#                 Age = Age * (-1),
#                 income = income * (-1), 
#                 Internet = Internet * (-1),
#                 vehicle = vehicle * (-1))

# lm_GA_D <- lm(Porp_Trump_Absentee ~ Porp_Trump_election_day * ring + Minority + Age + income + Internet + vehicle, data = Precinct_match_data_3rd_neg1)
# lm_GA_D %>% summary
# lm_GA_D %>% plot
```

```{r}
save(lm_GA,
     lm_GA_D,
     GA_anova,
     GA_anova_D,
     file = "GA/GA_Models.Rdata")
```

